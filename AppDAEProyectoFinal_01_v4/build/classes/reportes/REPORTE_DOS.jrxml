<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="REPORTE_DOS" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="b5a35392-36af-40f7-b7ed-4636b55238fe">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="568"/>
	<parameter name="fechaInicio" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fechaFin" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT
    M.id AS medico_id,
    CONCAT(M.nombres, ' ', M.apePaterno, ' ', M.apeMaterno) AS nombre_medico,
    CAST(COUNT(DC.cita_id) AS INTEGER) AS total_citas,
    TO_CHAR(MIN(C.fecha_cita), 'YYYY-MM-DD') AS primera_cita,
    TO_CHAR(MAX(C.fecha_cita), 'YYYY-MM-DD') AS ultima_cita
FROM
    MEDICO M
JOIN DETALLE_SERVICIO DS
    ON M.id = DS.medico_id
JOIN DETALLE_CITA DC
    ON DS.servicio_id = DC.detalle_servicio_serv_id
   AND DS.medico_id = DC.detalle_servicio_med_id
JOIN CITA C
    ON DC.cita_id = C.id
WHERE
    C.fecha_cita BETWEEN $P{fechaInicio} AND $P{fechaFin}
GROUP BY
    M.id, M.nombres, M.apePaterno, M.apeMaterno
ORDER BY
    M.id ASC;
]]>
	</queryString>
	<field name="medico_id" class="java.lang.Integer"/>
	<field name="nombre_medico" class="java.lang.String"/>
	<field name="total_citas" class="java.lang.Integer"/>
	<field name="primera_cita" class="java.lang.String"/>
	<field name="ultima_cita" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="37" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="555" height="35" uuid="97418aea-6911-4ee6-b02f-7bd0e072e302"/>
				<textElement textAlignment="Center">
					<font size="18" isBold="true"/>
				</textElement>
				<text><![CDATA[CITAS ATENDIDAS  POR CADA MÉDICO EN UN PERIODO]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band height="56" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="555" height="48" uuid="a3b1c9b8-ac81-437f-b5fc-3664f0f30064"/>
				<textElement textAlignment="Justified"/>
				<text><![CDATA[Este reporte muestra el número total de citas atendidas por cada médico en un período específico, junto con las fechas de la primera y última cita para cada médico. Los datos son filtrados según el rango de fechas proporcionado a través de los parámetros de entrada fechaInicio y fechaFin. ]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="65" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="47" height="20" uuid="1f0a94f6-fa92-44de-be07-0c6fa7738c05"/>
				<text><![CDATA[Periodo: ]]></text>
			</staticText>
			<textField>
				<reportElement x="47" y="0" width="52" height="20" uuid="325e33bf-a180-4510-9f8d-a50315a5045c"/>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("yyyy-MM-dd").format($P{fechaInicio})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="112" y="0" width="7" height="20" uuid="475147a7-e7b7-4993-9d8d-3c51745d1930"/>
				<text><![CDATA[-]]></text>
			</staticText>
			<textField>
				<reportElement x="141" y="0" width="58" height="20" uuid="3b530fb8-fe7a-4ba2-a59c-19395ad6c9d8"/>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("yyyy-MM-dd").format($P{fechaFin})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="0" y="45" width="56" height="15" uuid="727b9d9b-b78e-4ad5-a6f7-147176e5ceea"/>
				<text><![CDATA[ID Médico]]></text>
			</staticText>
			<staticText>
				<reportElement x="99" y="45" width="100" height="15" uuid="c3757a01-cb6e-486e-a1e0-01a48873234e"/>
				<text><![CDATA[Nombre del Médico]]></text>
			</staticText>
			<staticText>
				<reportElement x="231" y="45" width="100" height="15" uuid="cf91f3c2-3148-4d78-9ef0-db53c03ada13"/>
				<text><![CDATA[Total de Citas]]></text>
			</staticText>
			<staticText>
				<reportElement x="355" y="45" width="66" height="15" uuid="fcb0197a-ade5-45eb-b28f-7776f86305ee"/>
				<text><![CDATA[Primera Cita]]></text>
			</staticText>
			<staticText>
				<reportElement x="472" y="40" width="61" height="20" uuid="532da83c-543a-4d96-ba61-66333434b489"/>
				<text><![CDATA[Última Cita]]></text>
			</staticText>
			<line>
				<reportElement x="0" y="60" width="555" height="1" uuid="a54dfc75-bb7d-4f85-992c-7c3c83bcec0c"/>
			</line>
		</band>
	</columnHeader>
	<detail>
		<band height="27" splitType="Stretch">
			<textField>
				<reportElement x="99" y="0" width="100" height="20" uuid="988360a1-21f3-4b4a-afa5-5acf210a7154"/>
				<textFieldExpression><![CDATA[$F{nombre_medico}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="244" y="0" width="76" height="20" uuid="e64f74f4-b9cb-4d47-a959-878084866d1e"/>
				<textFieldExpression><![CDATA[$F{total_citas}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="355" y="0" width="87" height="20" uuid="3a0c373d-bdb8-4e1c-8add-37898c50b7e1"/>
				<textFieldExpression><![CDATA[$F{primera_cita}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="472" y="0" width="83" height="20" uuid="82924d4b-7bdc-4462-9c09-b16db4263b5b"/>
				<textFieldExpression><![CDATA[$F{ultima_cita}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="14" y="0" width="62" height="20" uuid="5587b653-4def-4df5-a658-cbc0018344f7"/>
				<textFieldExpression><![CDATA[$F{medico_id}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<pageFooter>
		<band height="54" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="34" width="167" height="20" uuid="a880b8ca-f42e-45a8-a053-e39bd24c74ce"/>
				<textElement>
					<font size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Hecho por Tirsa Rios Olazábal]]></text>
			</staticText>
			<textField>
				<reportElement x="450" y="34" width="105" height="20" uuid="4045e8e8-1bc6-402a-8042-4d5fdf0a9284"/>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new java.util.Date())]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="231" y="34" width="100" height="20" uuid="632aa955-ceaa-4b22-b20b-1ad9aa25bb87"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="802" splitType="Stretch">
			<pieChart>
				<chart>
					<reportElement x="0" y="36" width="555" height="391" uuid="a1e5287f-3094-4d55-93d2-dd1fbf24f377"/>
					<chartTitle/>
					<chartSubtitle/>
					<chartLegend/>
				</chart>
				<pieDataset>
					<keyExpression><![CDATA[$F{nombre_medico}]]></keyExpression>
					<valueExpression><![CDATA[$F{total_citas}]]></valueExpression>
				</pieDataset>
				<piePlot>
					<plot/>
					<itemLabel/>
				</piePlot>
			</pieChart>
			<staticText>
				<reportElement x="0" y="0" width="555" height="36" uuid="cab4a76e-91cd-49b8-b9d3-4af0546aefd5"/>
				<textElement textAlignment="Justified"/>
				<text><![CDATA[Este gráfico circular muestra la distribución de las citas atendidas por cada médico en el período seleccionado, permitiendo visualizar la participación de cada médico en el total de citas.]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="782" width="167" height="20" uuid="d557298b-be58-4e8a-a264-bb4fac2a8772"/>
				<textElement>
					<font size="11" isBold="true"/>
				</textElement>
				<text><![CDATA[Hecho por Tirsa Rios Olazábal]]></text>
			</staticText>
			<textField>
				<reportElement x="244" y="782" width="100" height="20" uuid="e617db39-445e-4f41-b2ae-1966e934bbff"/>
				<textFieldExpression><![CDATA[$V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="450" y="782" width="105" height="20" uuid="f7f9b491-3a74-4c65-af64-33bdd84e1b9d"/>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new java.util.Date())]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
